<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AMIR GAS POINT - Professional Bill</title>
  <style>
    /* ---------------------------------------------------------------------- */
    /* GLOBAL STYLES (For Screen View) */
    /* ---------------------------------------------------------------------- */
    body{
        font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        margin: 12px;
        background-color: #f0f2f5; 
        color: #333;
    }
    
    /* Main Content Wrapper (Used for screen layout) */
    .container {
        max-width: 700px;
        margin: 20px auto;
        padding: 25px;
        background-color: #ffffff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
    }

    /* Bill Header */
    .bill-header {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 3px solid #000;
        padding-bottom: 10px;
    }
    .bill-header h1{
        font-size: 28px;
        margin: 0;
        color: #000;
    }
    .bill-header p{
        font-size: 14px;
        color: #555;
        margin: 2px 0 0 0;
    }

    /* Input & Controls */
    label{
        display: block;
        margin-top: 10px;
        font-weight: 600; 
        font-size: 14px;
        color: #555;
    }
    input:not(#currentDate):not(#billNo), button {
        padding: 10px;
        margin-top: 4px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box; 
        font-size: 15px;
    }
    
    /* Action Button Styles */
    button {
        cursor: pointer;
        background-color: #007bff;
        color: white;
        border: none;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #0056b3;
    }
    
    /* Structure/Layouts */
    .controls{
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        border: 1px solid #e0e0e0; 
        border-radius: 5px;
        margin-top: 20px;
        padding: 15px;
        background-color: #f9f9f9;
    }
    .input-group {
        flex: 1 1 auto;
        min-width: 100px;
    }
    
    /* Customer & Bill Info Row */
    .info-row{
        display: flex; 
        justify-content: space-between;
        gap: 20px; 
        margin-bottom: 15px; 
        flex-wrap: wrap;
        padding-bottom: 10px;
        border-bottom: 1px dashed #ddd;
    }
    .info-row > div {
        flex: 1 1 30%; 
        min-width: 150px;
    }
    
    /* Table/Bill Items */
    table{
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
        border: 1px solid #ccc; 
    }
    th, td{
        border: 1px solid #ddd;
        padding: 10px 12px;
        text-align: left;
        font-size: 14px;
    }
    thead th {
        background-color: #333;
        color: white;
        text-transform: uppercase;
        font-weight: 700;
    }
    
    /* Footer Totals */
    tfoot td {
        border-top: 2px solid #000;
        font-size: 18px;
        background-color: #f0f0f0;
    }
    .right{
        text-align: right;
    }
    #total {
        font-weight: 700;
        color: #d9534f; 
        font-size: 20px;
    }
    
    /* QR & Utility */
    .qr{
        margin-top: 25px;
        text-align: center;
        padding: 15px;
        background-color: white;
        border: 1px solid #eee;
        border-radius: 5px;
    }
    .print-controls{
        margin-top: 20px;
        display:flex;
        gap:10px;
        flex-wrap:wrap;
    }
    
    /* Readonly inputs in screen view */
    #currentDate[readonly], #billNo[readonly] {
        background-color: #eee;
        cursor: default;
        padding: 10px;
        margin-top: 4px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box; 
        font-size: 15px;
    }
    
    /* ---------------------------------------------------------------------- */
    /* PRINT STYLES (The Professional Receipt Look) */
    /* ---------------------------------------------------------------------- */
    @media print{
        /* --- Watermark Fix (The main solution for brightness) --- */
        #bill-content {
            background-color: white;
            padding: 0;
            position: relative;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png'); /* <-- APNA LOGO URL BADLEIN */
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 80%;
        }

        /* ::before element se sirf watermark ko faint kiya */
        #bill-content::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: inherit; 
            background-repeat: inherit;
            background-position: inherit;
            background-size: inherit;
            opacity: 0.1; /* SIRF IMAGE ko FAINT kiya */
            z-index: -1; 
            /* Ye settings background ko print karne ke liye zaroori hain */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        body {
            margin: 0;
            background-color: white;
            padding: 0;
            /* Yahan koi background ya opacity nahi hai */
        }
        .container {
            /* Container print mein hatt jaega */
            box-shadow: none !important;
            display:none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Hide controls and non-essential items */
        button, .controls, .print-controls, #vpa, label[for="vpa"], .note, thead th:last-child, tbody td:last-child {
            display:none !important;
        }
        
        /* Show only the bill content and make text dark */
        #bill-content {
            display: block;
            width: 100%;
            margin: 0;
            padding: 15px; 
            color: #000 !important;
        }

        /* Header */
        .bill-header {
            border-bottom: 2px dashed #000;
            margin-bottom: 10px;
        }
        .bill-header h1, .bill-header p {
            color: #000 !important;
        }

        /* Info Row (Bill No, Date, Customer) */
        .info-row {
            display: flex;
            flex-direction: column; 
            border-bottom: 1px dashed #000;
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .info-row > div {
            margin-bottom: 4px;
            flex: 1 1 100%;
            display: flex;
            justify-content: space-between;
        }
        .info-row label {
            color: #000 !important;
        }
        .info-row input {
            border: none !important;
            padding: 0;
            margin: 0;
            display: inline;
            width: auto;
            font-weight: bold;
            font-size: 14px;
            background-color: transparent !important;
            color: #000 !important;
            text-align: right;
        }
        
        /* Table styles */
        table {
            border: 1px solid #000;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px 8px;
            font-size: 12px;
            color: #000 !important;
        }
        thead th {
            background-color: #eee;
            color: #000 !important;
            border-bottom: 2px solid #000;
        }
        tfoot td {
            border-top: 2px solid #000;
            background-color: white;
            font-size: 16px;
            font-weight: 700;
            color: #000 !important;
        }
        #total {
            color: #000 !important;
        }
        
        /* Footer/QR */
        .qr {
            display: block !important;
            margin-top: 15px;
            border: none;
            padding: 10px 0;
        }
        .qr #qrcode {
            margin: 0 auto;
        }

        /* Signature Line */
        .signature-line {
            display: block !important;
            border-top: 1px dashed #000;
            margin-top: 20px;
            padding-top: 10px;
            text-align: right;
            font-size: 14px;
            font-weight: 600;
            color: #000 !important;
        }
    }
  </style>
</head>
<body>
    <div class="container">
        <div id="bill-content"> 
            <div class="bill-header">
                <h1>AMIR GAS POINT TARAIYA</h1>
                <p>गैस, स्टोव, और एक्सेसरीज के लिए आपका वन-स्टॉप समाधान</p>
                <p>संपर्क: 7209076462 | पता: तरैया, सारण, बिहार</p>
            </div>

            <div class="info-row">
                <div>
                    <label for="billNo">Bill No./Invoice ID:</label>
                    <input id="billNo" placeholder="e.g., 2024/001" style="width:100%" />
                </div>
                <div>
                    <label for="currentDate">Date:</label>
                    <input id="currentDate" type="text" readonly style="width:100%" /> 
                </div>
                <div style="flex: 1 1 100%;">
                    <label for="customerName">Customer Name:</label>
                    <input id="customerName" placeholder="नाम लिखें" style="width:100%" />
                </div>
                <div style="flex: 1 1 100%;">
                    <label for="customerMobile">Mobile No.:</label>
                    <input id="customerMobile" type="tel" placeholder="10 अंकों का नंबर" style="width:100%" />
                </div>
            </div>

            <div style="margin-top:8px">
                <label for="vpa">आपका UPI ID:</label>
                <input id="vpa" value="7209076462-2@ybl" style="width:100%" />
            </div>

            <div class="controls">
                <div class="input-group" style="flex:1 1 30%">
                    <label for="itemName">Item नाम</label>
                    <input id="itemName" placeholder="नाम लिखें" style="width:100%" />
                </div>
                <div class="input-group" style="width:100px">
                    <label for="qty">Qty</label>
                    <input id="qty" type="number" min="1" value="1" style="width:100%" />
                </div>
                <div class="input-group" style="width:120px">
                    <label for="price">Price / Unit (₹)</label>
                    <input id="price" type="number" min="0" value="0" style="width:100%" />
                </div>
                <div class="input-group" style="align-self:flex-end">
                    <button id="addBtn" style="width:100%; height:42px;">Add Item</button>
                </div>
            </div>

            <table id="itemsTable">
                <thead>
                    <tr><th>S. No.</th><th>Item</th><th>Qty</th><th>Price/Unit (₹)</th><th>Amount (₹)</th><th></th></tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                    <tr><td colspan="4" class="right"><strong>Grand Total (₹)</strong></td><td id="total">0</td><td></td></tr>
                </tfoot>
            </table>

            <div id="result" class="qr" style="display:none;"></div>

            <div class="signature-line" style="display:none;">
                अधिकृत हस्ताक्षर / Authorized Signature
            </div>

        </div> <div class="print-controls">
            <button id="generate">Generate Payment QR</button>
            <button id="print">Print Bill</button>
            <button id="clear">Clear All</button>
        </div>
    </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    const items = [];
    const tbody = document.querySelector('#itemsTable tbody');
    const totalEl = document.getElementById('total');
    const qrResultEl = document.getElementById('result');

    // Function to format date as DD/MM/YYYY
    function getFormattedDate() {
        const today = new Date();
        const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
        return today.toLocaleDateString('en-GB', options); // DD/MM/YYYY format
    }

    // Set current date on load
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('currentDate').value = getFormattedDate();
    });
    
    function render(){
      tbody.innerHTML = '';
      let total = 0;
      items.forEach((it,i)=>{
        const tr = document.createElement('tr');
        // Round amount to 2 decimal places for accurate total
        const amount = Math.round((it.qty * it.price) * 100) / 100;
        total = Math.round((total + amount) * 100) / 100;
        
        tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(it.name)}</td><td>${it.qty}</td><td>${it.price.toFixed(2)}</td><td>${amount.toFixed(2)}</td><td><button data-i='${i}'>Delete</button></td>`;
        tbody.appendChild(tr);
      });
      totalEl.textContent = total.toFixed(2);
      
      // Clear QR if items are modified
      qrResultEl.innerHTML = '';
      qrResultEl.style.display = 'none';
    }

    function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}

    document.getElementById('addBtn').addEventListener('click',()=>{
      const name = document.getElementById('itemName').value.trim();
      const qty = Number(document.getElementById('qty').value) || 0;
      const price = Number(document.getElementById('price').value) || 0;
      
      if(!name || qty <= 0 || price < 0){
          alert('कृपया Item का नाम, सही Qty (1 या उससे अधिक) और Price भरें।');
          return;
      }
      
      items.push({name,qty,price});
      document.getElementById('itemName').value=''; 
      document.getElementById('qty').value=1; 
      document.getElementById('price').value=0;
      render();
    });

    tbody.addEventListener('click',e=>{
      if(e.target.tagName==='BUTTON'){
        const i = Number(e.target.dataset.i);
        items.splice(i,1); render();
      }
    });

    document.getElementById('clear').addEventListener('click',()=>{
        if(confirm('सभी आइटम और डाटा हटाएं?')){
            items.length=0;
            render();
            document.getElementById('result').innerHTML='';
            document.getElementById('result').style.display = 'none';
            document.getElementById('customerName').value = '';
            document.getElementById('customerMobile').value = '';
            document.getElementById('billNo').value = '';
        }
    });
    
    // *** GUARANTEED PRINT FUNCTION ***
    document.getElementById('print').addEventListener('click',()=>{
        // Check if the print function is available and call it
        if (typeof window.print === 'function') {
            window.print();
        } else {
            alert('माफ़ कीजिए, आपके ब्राउज़र में प्रिंट फंक्शन काम नहीं कर रहा है।');
        }
    });
    // **********************************

    document.getElementById('generate').addEventListener('click',()=>{
      const vpa = (document.getElementById('vpa').value||'').trim();
      const total = Number(totalEl.textContent)||0;
      const customerName = document.getElementById('customerName').value.trim();
      
      if(!vpa){alert('UPI ID (VPA) डालें');return}
      if(total<=0){alert('कम से कम एक आइटम जोड़ें');return}

      let payeeName = customerName || 'AMIR GAS POINT TARAIYA'; 
      let upiLink = `upi://pay?pa=${encodeURIComponent(vpa)}&pn=${encodeURIComponent(payeeName)}&am=${totalEl.textContent}&cu=INR`;
      
      qrResultEl.innerHTML = `<div style="font-size: 16px; margin-bottom: 10px;"><strong>Scan to Pay ₹${totalEl.textContent}</strong></div><div id='qrcode'></div>`;
      new QRCode(document.getElementById('qrcode'), {text: upiLink, width: 180, height: 180, colorDark: "#000000", colorLight: "#ffffff", correctLevel: QRCode.CorrectLevel.H});
      qrResultEl.style.display = 'block';
    });

    render();
  </script>
</body>
</html>
